"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginRenderer = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function getCursorPosition(textarea) {
  var rangeData = {
    text: '',
    start: 0,
    end: 0
  };

  if (textarea.setSelectionRange) {
    rangeData.start = textarea.selectionStart;
    rangeData.end = textarea.selectionEnd;
  }

  return rangeData;
}

function setCursorPosition(textarea, rangeData) {
  if (textarea.setSelectionRange) {
    textarea.focus();
    textarea.setSelectionRange(rangeData.start, rangeData.end);
  }
}

var $text;

if (typeof document !== 'undefined') {
  $text = document.createElement('span');
  $text.className = 'x-textarea--resize';
  $text.style.visibility = 'hidden';
  $text.style.zIndex = '-1';
  $text.style.position = 'absolute';
}

function autoResizeTextarea(evnt, renderOpts, params) {
  var _renderOpts$props = renderOpts.props,
      props = _renderOpts$props === void 0 ? {} : _renderOpts$props;
  var $table = params.$table,
      column = params.column;
  var minWidth = column.renderWidth,
      minHeight = column.renderHeight;
  var inpElem = evnt.target; // let cell = inpElem.parentNode.parentNode ? inpElem.parentNode.parentNode.parentNode : null

  var maxWidth = props.maxWidth || 600;
  var maxHeight = props.maxHeight || 400;
  $text.textContent = "".concat(inpElem.value, "\n");
  $text.style.maxWidth = "".concat(maxWidth, "px");

  if (!$text.parentNode) {
    $table.$el.appendChild($text);
  }

  var height = Math.min(maxHeight, $text.offsetHeight + 4);
  inpElem.style.width = "".concat(Math.min(maxWidth, Math.max(minWidth, $text.offsetWidth + 20)), "px");
  inpElem.style.height = "".concat(height < minHeight ? minHeight : height, "px");
  inpElem.style.overflowY = height > maxWidth ? 'auto' : '';
}

function getEvents(renderOpts, params) {
  var events = renderOpts.events;
  var $table = params.$table,
      column = params.column;
  var model = column.model;
  var on = {
    input: function input(evnt) {
      var cellValue = evnt.target.value;
      model.update = true;
      model.value = cellValue;
      $table.updateStatus(params, cellValue);
    }
  };

  if (events) {
    _xeUtils["default"].assign(on, _xeUtils["default"].objectMap(events, function (cb) {
      return function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        cb.apply(null, [params].concat.apply(params, args));
      };
    }));
  }

  return on;
}
/**
 * 渲染函数
 */


var renderMap = {
  XInput: {
    autofocus: '.x-input',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var _renderOpts$props2 = renderOpts.props,
          props = _renderOpts$props2 === void 0 ? {} : _renderOpts$props2,
          attrs = renderOpts.attrs,
          _renderOpts$events = renderOpts.events,
          events = _renderOpts$events === void 0 ? {} : _renderOpts$events;
      var column = params.column;
      var model = column.model;
      var prefixIcon = props.prefixIcon,
          suffixIcon = props.suffixIcon;
      var prefixClick = events.prefixClick,
          suffixClick = events.suffixClick;
      return [h('div', {
        "class": ['x-input--wrapper', {
          'is--prefix': props.prefixIcon,
          'is--suffix': props.suffixIcon
        }],
        style: {
          height: "".concat(column.renderHeight - 1, "px")
        }
      }, [prefixIcon ? h('i', {
        "class": ['x-input--prefix', prefixIcon, {
          'is--trigger': prefixClick
        }],
        on: prefixClick ? {
          click: function click(evnt) {
            return prefixClick(params, evnt);
          }
        } : null
      }) : null, h('input', {
        "class": 'x-input',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: getEvents(renderOpts, params)
      }), suffixIcon ? h('i', {
        "class": ['x-input--suffix', suffixIcon, {
          'is--trigger': suffixClick
        }],
        on: suffixClick ? {
          click: function click(evnt) {
            return suffixClick(params, evnt);
          }
        } : null
      }) : null])];
    }
  },
  XTextarea: {
    autofocus: '.x-textarea',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var attrs = renderOpts.attrs,
          events = renderOpts.events;
      var $table = params.$table,
          column = params.column;
      var model = column.model;

      var autoResizeEvent = function autoResizeEvent(evnt) {
        setTimeout(function () {
          return autoResizeTextarea(evnt, renderOpts, params);
        }, 0);

        if (events && events[evnt.type]) {
          events[evnt.type](params, evnt);
        }
      };

      return [h('div', {
        "class": 'x-textarea--wrapper',
        style: {
          height: "".concat(column.renderHeight - 1, "px")
        }
      }, [h('textarea', {
        "class": 'x-textarea',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: _xeUtils["default"].assign(getEvents(renderOpts, params), {
          cut: autoResizeEvent,
          paste: autoResizeEvent,
          drop: autoResizeEvent,
          focus: autoResizeEvent,
          keydown: function keydown(evnt) {
            if (evnt.keyCode === 13 && (!$table.keyboardConfig || evnt.altKey)) {
              evnt.preventDefault();
              evnt.stopPropagation();
              var inpElem = evnt.target;
              var rangeData = getCursorPosition(inpElem);
              var pos = rangeData.end;
              var cellValue = inpElem.value;
              cellValue = "".concat(cellValue.slice(0, pos), "\n").concat(cellValue.slice(pos, cellValue.length));
              inpElem.value = cellValue;
              model.update = true;
              model.value = cellValue;
              setTimeout(function () {
                rangeData.start = rangeData.end = ++pos;
                setCursorPosition(inpElem, rangeData);
                autoResizeEvent(evnt);
              });
            } else {
              autoResizeEvent(evnt);
            }
          },
          compositionstart: autoResizeEvent,
          compositionupdate: autoResizeEvent,
          compositionend: autoResizeEvent
        })
      })])];
    },
    renderCell: function renderCell(h, renderOpts, params) {
      var row = params.row,
          column = params.column;
      return [h('span', {
        "class": 'x-textarea--content'
      }, _xeUtils["default"].get(row, column.property))];
    }
  }
};
/**
 * 基于 vxe-table 表格的增强插件，提供一些常用的渲染器
 */

var VXETablePluginRenderer = {
  install: function install(xtable) {
    xtable.renderer.mixin(renderMap);
  }
};
exports.VXETablePluginRenderer = VXETablePluginRenderer;

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginRenderer);
}

var _default = VXETablePluginRenderer;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImdldEN1cnNvclBvc2l0aW9uIiwidGV4dGFyZWEiLCJyYW5nZURhdGEiLCJ0ZXh0Iiwic3RhcnQiLCJlbmQiLCJzZXRTZWxlY3Rpb25SYW5nZSIsInNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uRW5kIiwic2V0Q3Vyc29yUG9zaXRpb24iLCJmb2N1cyIsIiR0ZXh0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiekluZGV4IiwicG9zaXRpb24iLCJhdXRvUmVzaXplVGV4dGFyZWEiLCJldm50IiwicmVuZGVyT3B0cyIsInBhcmFtcyIsInByb3BzIiwiJHRhYmxlIiwiY29sdW1uIiwibWluV2lkdGgiLCJyZW5kZXJXaWR0aCIsIm1pbkhlaWdodCIsInJlbmRlckhlaWdodCIsImlucEVsZW0iLCJ0YXJnZXQiLCJtYXhXaWR0aCIsIm1heEhlaWdodCIsInRleHRDb250ZW50IiwidmFsdWUiLCJwYXJlbnROb2RlIiwiJGVsIiwiYXBwZW5kQ2hpbGQiLCJoZWlnaHQiLCJNYXRoIiwibWluIiwib2Zmc2V0SGVpZ2h0Iiwid2lkdGgiLCJtYXgiLCJvZmZzZXRXaWR0aCIsIm92ZXJmbG93WSIsImdldEV2ZW50cyIsImV2ZW50cyIsIm1vZGVsIiwib24iLCJpbnB1dCIsImNlbGxWYWx1ZSIsInVwZGF0ZSIsInVwZGF0ZVN0YXR1cyIsIlhFVXRpbHMiLCJhc3NpZ24iLCJvYmplY3RNYXAiLCJjYiIsImFyZ3MiLCJhcHBseSIsImNvbmNhdCIsInJlbmRlck1hcCIsIlhJbnB1dCIsImF1dG9mb2N1cyIsInJlbmRlckVkaXQiLCJoIiwiYXR0cnMiLCJwcmVmaXhJY29uIiwic3VmZml4SWNvbiIsInByZWZpeENsaWNrIiwic3VmZml4Q2xpY2siLCJjbGljayIsImRvbVByb3BzIiwiWFRleHRhcmVhIiwiYXV0b1Jlc2l6ZUV2ZW50Iiwic2V0VGltZW91dCIsInR5cGUiLCJjdXQiLCJwYXN0ZSIsImRyb3AiLCJrZXlkb3duIiwia2V5Q29kZSIsImtleWJvYXJkQ29uZmlnIiwiYWx0S2V5IiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJwb3MiLCJzbGljZSIsImxlbmd0aCIsImNvbXBvc2l0aW9uc3RhcnQiLCJjb21wb3NpdGlvbnVwZGF0ZSIsImNvbXBvc2l0aW9uZW5kIiwicmVuZGVyQ2VsbCIsInJvdyIsImdldCIsInByb3BlcnR5IiwiVlhFVGFibGVQbHVnaW5SZW5kZXJlciIsImluc3RhbGwiLCJ4dGFibGUiLCJyZW5kZXJlciIsIm1peGluIiwid2luZG93IiwiVlhFVGFibGUiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQVNBLFNBQVNBLGlCQUFULENBQTRCQyxRQUE1QixFQUF5RDtBQUN2RCxNQUFJQyxTQUFTLEdBQWlCO0FBQUVDLElBQUFBLElBQUksRUFBRSxFQUFSO0FBQVlDLElBQUFBLEtBQUssRUFBRSxDQUFuQjtBQUFzQkMsSUFBQUEsR0FBRyxFQUFFO0FBQTNCLEdBQTlCOztBQUNBLE1BQUlKLFFBQVEsQ0FBQ0ssaUJBQWIsRUFBZ0M7QUFDOUJKLElBQUFBLFNBQVMsQ0FBQ0UsS0FBVixHQUFrQkgsUUFBUSxDQUFDTSxjQUEzQjtBQUNBTCxJQUFBQSxTQUFTLENBQUNHLEdBQVYsR0FBZ0JKLFFBQVEsQ0FBQ08sWUFBekI7QUFDRDs7QUFDRCxTQUFPTixTQUFQO0FBQ0Q7O0FBRUQsU0FBU08saUJBQVQsQ0FBNEJSLFFBQTVCLEVBQTJEQyxTQUEzRCxFQUFrRjtBQUNoRixNQUFJRCxRQUFRLENBQUNLLGlCQUFiLEVBQWdDO0FBQzlCTCxJQUFBQSxRQUFRLENBQUNTLEtBQVQ7QUFDQVQsSUFBQUEsUUFBUSxDQUFDSyxpQkFBVCxDQUEyQkosU0FBUyxDQUFDRSxLQUFyQyxFQUE0Q0YsU0FBUyxDQUFDRyxHQUF0RDtBQUNEO0FBQ0Y7O0FBRUQsSUFBSU0sS0FBSjs7QUFDQSxJQUFJLE9BQU9DLFFBQVAsS0FBb0IsV0FBeEIs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QUFQO0FBS0Q7QUFsRVE7QUEvQ0ssQ0FBbEI7QUFxSEE7Ozs7QUFHTyxJQUFNQyxzQkFBc0IsR0FBRztBQUNwQ0MsRUFBQUEsT0FEb0MsbUJBQzNCQyxNQUQyQixFQUNKO0FBQzlCQSxJQUFBQSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLEtBQWhCLENBQXNCdkMsU0FBdEI7QUFDRDtBQUhtQyxDQUEvQjs7O0FBTVAsSUFBSSxPQUFPd0MsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDQyxRQUE1QyxFQUFzRDtBQUNwREQsRUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxHQUFoQixDQUFvQlAsc0JBQXBCO0FBQ0Q7O2VBRWNBLHNCIiwiZmlsZSI6ImluZGV4LmNvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzJ1xyXG5pbXBvcnQgVlhFVGFibGUgZnJvbSAndnhlLXRhYmxlL2xpYi92eGUtdGFibGUnXHJcblxyXG5pbnRlcmZhY2UgcG9zUmFuZ2VEYXRhIHtcclxuICB0ZXh0OiBzdHJpbmc7XHJcbiAgc3RhcnQ6IG51bWJlcjtcclxuICBlbmQ6IG51bWJlcjtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q3Vyc29yUG9zaXRpb24gKHRleHRhcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50KTogcG9zUmFuZ2VEYXRhIHtcclxuICBsZXQgcmFuZ2VEYXRhOiBwb3NSYW5nZURhdGEgPSB7IHRleHQ6ICcnLCBzdGFydDogMCwgZW5kOiAwIH1cclxuICBpZiAodGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcclxuICAgIHJhbmdlRGF0YS5zdGFydCA9IHRleHRhcmVhLnNlbGVjdGlvblN0YXJ0XHJcbiAgICByYW5nZURhdGEuZW5kID0gdGV4dGFyZWEuc2VsZWN0aW9uRW5kXHJcbiAgfVxyXG4gIHJldHVybiByYW5nZURhdGFcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Q3Vyc29yUG9zaXRpb24gKHRleHRhcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50LCByYW5nZURhdGE6IHBvc1JhbmdlRGF0YSkge1xyXG4gIGlmICh0ZXh0YXJlYS5zZXRTZWxlY3Rpb25SYW5nZSkge1xyXG4gICAgdGV4dGFyZWEuZm9jdXMoKVxyXG4gICAgdGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UocmFuZ2VEYXRhLnN0YXJ0LCByYW5nZURhdGEuZW5kKVxyXG4gIH1cclxufVxyXG5cclxudmFyICR0ZXh0OiBIVE1MU3BhbkVsZW1lbnRcclxuaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAkdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxyXG4gICR0ZXh0LmNsYXNzTmFtZSA9ICd4LXRleHRhcmVhLS1yZXNpemUnXHJcbiAgJHRleHQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nXHJcbiAgJHRleHQuc3R5bGUuekluZGV4ID0gJy0xJ1xyXG4gICR0ZXh0LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJ1xyXG59XHJcblxyXG5mdW5jdGlvbiBhdXRvUmVzaXplVGV4dGFyZWEgKGV2bnQ6IGFueSwgcmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gIGxldCB7IHByb3BzID0ge30gfSA9IHJlbmRlck9wdHNcclxuICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgbGV0IHsgcmVuZGVyV2lkdGg6IG1pbldpZHRoLCByZW5kZXJIZWlnaHQ6IG1pbkhlaWdodCB9ID0gY29sdW1uXHJcbiAgbGV0IGlucEVsZW06IEhUTUxJbnB1dEVsZW1lbnQgPSBldm50LnRhcmdldFxyXG4gIC8vIGxldCBjZWxsID0gaW5wRWxlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUgPyBpbnBFbGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlIDogbnVsbFxyXG4gIGxldCBtYXhXaWR0aDogbnVtYmVyID0gcHJvcHMubWF4V2lkdGggfHwgNjAwXHJcbiAgbGV0IG1heEhlaWdodDogbnVtYmVyID0gcHJvcHMubWF4SGVpZ2h0IHx8IDQwMFxyXG4gICR0ZXh0LnRleHRDb250ZW50ID0gYCR7aW5wRWxlbS52YWx1ZX1cXG5gXHJcbiAgJHRleHQuc3R5bGUubWF4V2lkdGggPSBgJHttYXhXaWR0aH1weGBcclxuICBpZiAoISR0ZXh0LnBhcmVudE5vZGUpIHtcclxuICAgICR0YWJsZS4kZWwuYXBwZW5kQ2hpbGQoJHRleHQpXHJcbiAgfVxyXG4gIGxldCBoZWlnaHQgPSBNYXRoLm1pbihtYXhIZWlnaHQsICR0ZXh0Lm9mZnNldEhlaWdodCArIDQpXHJcbiAgaW5wRWxlbS5zdHlsZS53aWR0aCA9IGAke01hdGgubWluKG1heFdpZHRoLCBNYXRoLm1heChtaW5XaWR0aCwgJHRleHQub2Zmc2V0V2lkdGggKyAyMCkpfXB4YFxyXG4gIGlucEVsZW0uc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0IDwgbWluSGVpZ2h0ID8gbWluSGVpZ2h0IDogaGVpZ2h0fXB4YFxyXG4gIGlucEVsZW0uc3R5bGUub3ZlcmZsb3dZID0gaGVpZ2h0ID4gbWF4V2lkdGggPyAnYXV0bycgOiAnJ1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRFdmVudHMgKHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICBsZXQgeyBldmVudHMgfSA9IHJlbmRlck9wdHNcclxuICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgbGV0IHsgbW9kZWwgfSA9IGNvbHVtblxyXG4gIGxldCBvbiA9IHtcclxuICAgIGlucHV0IChldm50OiBhbnkpIHtcclxuICAgICAgbGV0IGNlbGxWYWx1ZSA9IGV2bnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgIG1vZGVsLnVwZGF0ZSA9IHRydWVcclxuICAgICAgbW9kZWwudmFsdWUgPSBjZWxsVmFsdWVcclxuICAgICAgJHRhYmxlLnVwZGF0ZVN0YXR1cyhwYXJhbXMsIGNlbGxWYWx1ZSlcclxuICAgIH1cclxuICB9XHJcbiAgaWYgKGV2ZW50cykge1xyXG4gICAgWEVVdGlscy5hc3NpZ24ob24sIFhFVXRpbHMub2JqZWN0TWFwKGV2ZW50cywgKGNiOiBGdW5jdGlvbikgPT4gZnVuY3Rpb24gKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAgIGNiLmFwcGx5KG51bGwsIFtwYXJhbXNdLmNvbmNhdC5hcHBseShwYXJhbXMsIGFyZ3MpKVxyXG4gICAgfSkpXHJcbiAgfVxyXG4gIHJldHVybiBvblxyXG59XHJcblxyXG4vKipcclxuICog5riy5p+T5Ye95pWwXHJcbiAqL1xyXG5jb25zdCByZW5kZXJNYXAgPSB7XHJcbiAgWElucHV0OiB7XHJcbiAgICBhdXRvZm9jdXM6ICcueC1pbnB1dCcsXHJcbiAgICByZW5kZXJFZGl0IChoOiBGdW5jdGlvbiwgcmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gICAgICBsZXQgeyBwcm9wcyA9IHt9LCBhdHRycywgZXZlbnRzID0ge30gfSA9IHJlbmRlck9wdHNcclxuICAgICAgbGV0IHsgY29sdW1uIH0gPSBwYXJhbXNcclxuICAgICAgbGV0IHsgbW9kZWwgfSA9IGNvbHVtblxyXG4gICAgICBsZXQgeyBwcmVmaXhJY29uLCBzdWZmaXhJY29uIH0gPSBwcm9wc1xyXG4gICAgICBsZXQgeyBwcmVmaXhDbGljaywgc3VmZml4Q2xpY2sgfSA9IGV2ZW50c1xyXG4gICAgICByZXR1cm4gW1xyXG4gICAgICAgIGgoJ2RpdicsIHtcclxuICAgICAgICAgIGNsYXNzOiBbJ3gtaW5wdXQtLXdyYXBwZXInLCB7XHJcbiAgICAgICAgICAgICdpcy0tcHJlZml4JzogcHJvcHMucHJlZml4SWNvbixcclxuICAgICAgICAgICAgJ2lzLS1zdWZmaXgnOiBwcm9wcy5zdWZmaXhJY29uXHJcbiAgICAgICAgICB9XSxcclxuICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgIGhlaWdodDogYCR7Y29sdW1uLnJlbmRlckhlaWdodCAtIDF9cHhgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgW1xyXG4gICAgICAgICAgcHJlZml4SWNvbiA/IGgoJ2knLCB7XHJcbiAgICAgICAgICAgIGNsYXNzOiBbJ3gtaW5wdXQtLXByZWZpeCcsIHByZWZpeEljb24sIHtcclxuICAgICAgICAgICAgICAnaXMtLXRyaWdnZXInOiBwcmVmaXhDbGlja1xyXG4gICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgb246IHByZWZpeENsaWNrID8ge1xyXG4gICAgICAgICAgICAgIGNsaWNrOiAoZXZudDogYW55KSA9PiBwcmVmaXhDbGljayhwYXJhbXMsIGV2bnQpXHJcbiAgICAgICAgICAgIH0gOiBudWxsXHJcbiAgICAgICAgICB9KSA6IG51bGwsXHJcbiAgICAgICAgICBoKCdpbnB1dCcsIHtcclxuICAgICAgICAgICAgY2xhc3M6ICd4LWlucHV0JyxcclxuICAgICAgICAgICAgYXR0cnMsXHJcbiAgICAgICAgICAgIGRvbVByb3BzOiB7XHJcbiAgICAgICAgICAgICAgdmFsdWU6IG1vZGVsLnZhbHVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uOiBnZXRFdmVudHMocmVuZGVyT3B0cywgcGFyYW1zKVxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBzdWZmaXhJY29uID8gaCgnaScsIHtcclxuICAgICAgICAgICAgY2xhc3M6IFsneC1pbnB1dC0tc3VmZml4Jywgc3VmZml4SWNvbiwge1xyXG4gICAgICAgICAgICAgICdpcy0tdHJpZ2dlcic6IHN1ZmZpeENsaWNrXHJcbiAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBvbjogc3VmZml4Q2xpY2sgPyB7XHJcbiAgICAgICAgICAgICAgY2xpY2s6IChldm50OiBhbnkpID0+IHN1ZmZpeENsaWNrKHBhcmFtcywgZXZudClcclxuICAgICAgICAgICAgfSA6IG51bGxcclxuICAgICAgICAgIH0pIDogbnVsbFxyXG4gICAgICAgIF0pXHJcbiAgICAgIF1cclxuICAgIH1cclxuICB9LFxyXG4gIFhUZXh0YXJlYToge1xyXG4gICAgYXV0b2ZvY3VzOiAnLngtdGV4dGFyZWEnLFxyXG4gICAgcmVuZGVyRWRpdCAoaDogRnVuY3Rpb24sIHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICAgICAgbGV0IHsgYXR0cnMsIGV2ZW50cyB9ID0gcmVuZGVyT3B0c1xyXG4gICAgICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgICAgIGxldCB7IG1vZGVsIH0gPSBjb2x1bW5cclxuICAgICAgbGV0IGF1dG9SZXNpemVFdmVudCA9IChldm50OiBhbnkpID0+IHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGF1dG9SZXNpemVUZXh0YXJlYShldm50LCByZW5kZXJPcHRzLCBwYXJhbXMpLCAwKVxyXG4gICAgICAgIGlmIChldmVudHMgJiYgZXZlbnRzW2V2bnQudHlwZV0pIHtcclxuICAgICAgICAgIGV2ZW50c1tldm50LnR5cGVdKHBhcmFtcywgZXZudClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICBjbGFzczogJ3gtdGV4dGFyZWEtLXdyYXBwZXInLFxyXG4gICAgICAgICAgc3R5bGU6IHtcclxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtjb2x1bW4ucmVuZGVySGVpZ2h0IC0gMX1weGBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBbXHJcbiAgICAgICAgICBoKCd0ZXh0YXJlYScsIHtcclxuICAgICAgICAgICAgY2xhc3M6ICd4LXRleHRhcmVhJyxcclxuICAgICAgICAgICAgYXR0cnMsXHJcbiAgICAgICAgICAgIGRvbVByb3BzOiB7XHJcbiAgICAgICAgICAgICAgdmFsdWU6IG1vZGVsLnZhbHVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uOiBYRVV0aWxzLmFzc2lnbihnZXRFdmVudHMocmVuZGVyT3B0cywgcGFyYW1zKSwge1xyXG4gICAgICAgICAgICAgIGN1dDogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIHBhc3RlOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAgZHJvcDogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIGZvY3VzOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAga2V5ZG93biAoZXZudDogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZudC5rZXlDb2RlID09PSAxMyAmJiAoISR0YWJsZS5rZXlib2FyZENvbmZpZyB8fCBldm50LmFsdEtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgZXZudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICAgICAgICAgICAgICAgIGV2bnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgICAgICAgICAgICAgICAgbGV0IGlucEVsZW0gPSBldm50LnRhcmdldFxyXG4gICAgICAgICAgICAgICAgICBsZXQgcmFuZ2VEYXRhID0gZ2V0Q3Vyc29yUG9zaXRpb24oaW5wRWxlbSlcclxuICAgICAgICAgICAgICAgICAgbGV0IHBvcyA9IHJhbmdlRGF0YS5lbmRcclxuICAgICAgICAgICAgICAgICAgbGV0IGNlbGxWYWx1ZSA9IGlucEVsZW0udmFsdWVcclxuICAgICAgICAgICAgICAgICAgY2VsbFZhbHVlID0gYCR7Y2VsbFZhbHVlLnNsaWNlKDAsIHBvcyl9XFxuJHtjZWxsVmFsdWUuc2xpY2UocG9zLCBjZWxsVmFsdWUubGVuZ3RoKX1gXHJcbiAgICAgICAgICAgICAgICAgIGlucEVsZW0udmFsdWUgPSBjZWxsVmFsdWVcclxuICAgICAgICAgICAgICAgICAgbW9kZWwudXBkYXRlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICBtb2RlbC52YWx1ZSA9IGNlbGxWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZURhdGEuc3RhcnQgPSByYW5nZURhdGEuZW5kID0gKytwb3NcclxuICAgICAgICAgICAgICAgICAgICBzZXRDdXJzb3JQb3NpdGlvbihpbnBFbGVtLCByYW5nZURhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgYXV0b1Jlc2l6ZUV2ZW50KGV2bnQpXHJcbiAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBhdXRvUmVzaXplRXZlbnQoZXZudClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGNvbXBvc2l0aW9uc3RhcnQ6IGF1dG9SZXNpemVFdmVudCxcclxuICAgICAgICAgICAgICBjb21wb3NpdGlvbnVwZGF0ZTogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIGNvbXBvc2l0aW9uZW5kOiBhdXRvUmVzaXplRXZlbnRcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgXSlcclxuICAgICAgXVxyXG4gICAgfSxcclxuICAgIHJlbmRlckNlbGwgKGg6IEZ1bmN0aW9uLCByZW5kZXJPcHRzOiBhbnksIHBhcmFtczogYW55KSB7XHJcbiAgICAgIGxldCB7IHJvdywgY29sdW1uIH0gPSBwYXJhbXNcclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICBoKCdzcGFuJywge1xyXG4gICAgICAgICAgY2xhc3M6ICd4LXRleHRhcmVhLS1jb250ZW50J1xyXG4gICAgICAgIH0sIFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcclxuICAgICAgXVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5o+Q5L6b5LiA5Lqb5bi455So55qE5riy5p+T5ZmoXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5SZW5kZXJlciA9IHtcclxuICBpbnN0YWxsICh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgeHRhYmxlLnJlbmRlcmVyLm1peGluKHJlbmRlck1hcClcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luUmVuZGVyZXIpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luUmVuZGVyZXJcclxuIl19

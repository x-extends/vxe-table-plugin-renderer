"use strict";

exports.__esModule = true;

var xe_utils_1 = require("xe-utils/methods/xe-utils");

function getCursorPosition(textarea) {
  var rangeData = {
    text: '',
    start: 0,
    end: 0
  };

  if (textarea.setSelectionRange) {
    rangeData.start = textarea.selectionStart;
    rangeData.end = textarea.selectionEnd;
  }

  return rangeData;
}

function setCursorPosition(textarea, rangeData) {
  if (textarea.setSelectionRange) {
    textarea.focus();
    textarea.setSelectionRange(rangeData.start, rangeData.end);
  }
}

var $text;

if (typeof document !== 'undefined') {
  $text = document.createElement('span');
  $text.className = 'x-textarea--resize';
  $text.style.visibility = 'hidden';
  $text.style.zIndex = '-1';
  $text.style.position = 'absolute';
}

function autoResizeTextarea(evnt, renderOpts, params) {
  var _a = renderOpts.props,
      props = _a === void 0 ? {} : _a;
  var $table = params.$table,
      column = params.column;
  var minWidth = column.renderWidth,
      minHeight = column.renderHeight;
  var inpElem = evnt.target; // let cell = inpElem.parentNode.parentNode ? inpElem.parentNode.parentNode.parentNode : null

  var maxWidth = props.maxWidth || 600;
  var maxHeight = props.maxHeight || 400;
  $text.textContent = inpElem.value + "\n";
  $text.style.maxWidth = maxWidth + "px";

  if (!$text.parentNode) {
    $table.$el.appendChild($text);
  }

  var height = Math.min(maxHeight, $text.offsetHeight + 4);
  inpElem.style.width = Math.min(maxWidth, Math.max(minWidth, $text.offsetWidth + 20)) + "px";
  inpElem.style.height = (height < minHeight ? minHeight : height) + "px";
  inpElem.style.overflowY = height > maxWidth ? 'auto' : '';
}

function getEvents(renderOpts, params) {
  var events = renderOpts.events;
  var $table = params.$table,
      column = params.column;
  var model = column.model;
  var on = {
    input: function input(evnt) {
      var cellValue = evnt.target.value;
      model.update = true;
      model.value = cellValue;
      $table.updateStatus(params, cellValue);
    }
  };

  if (events) {
    xe_utils_1["default"].assign(on, xe_utils_1["default"].objectMap(events, function (cb) {
      return function () {
        cb.apply(null, [params].concat.apply(params, arguments));
      };
    }));
  }

  return on;
}
/**
 * 渲染函数
 */


var renderMap = {
  XInput: {
    autofocus: '.x-input',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var _a = renderOpts.props,
          props = _a === void 0 ? {} : _a,
          attrs = renderOpts.attrs,
          _b = renderOpts.events,
          events = _b === void 0 ? {} : _b;
      var column = params.column;
      var model = column.model;
      var prefixIcon = props.prefixIcon,
          suffixIcon = props.suffixIcon;
      var prefixClick = events.prefixClick,
          suffixClick = events.suffixClick;
      return [h('div', {
        "class": ['x-input--wrapper', {
          'is--prefix': props.prefixIcon,
          'is--suffix': props.suffixIcon
        }],
        style: {
          height: column.renderHeight - 1 + "px"
        }
      }, [prefixIcon ? h('i', {
        "class": ['x-input--prefix', prefixIcon, {
          'is--trigger': prefixClick
        }],
        on: prefixClick ? {
          click: function click(evnt) {
            return prefixClick(params, evnt);
          }
        } : null
      }) : null, h('input', {
        "class": 'x-input',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: getEvents(renderOpts, params)
      }), suffixIcon ? h('i', {
        "class": ['x-input--suffix', suffixIcon, {
          'is--trigger': suffixClick
        }],
        on: suffixClick ? {
          click: function click(evnt) {
            return suffixClick(params, evnt);
          }
        } : null
      }) : null])];
    }
  },
  XTextarea: {
    autofocus: '.x-textarea',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var attrs = renderOpts.attrs,
          events = renderOpts.events;
      var $table = params.$table,
          column = params.column;
      var model = column.model;

      var autoResizeEvent = function autoResizeEvent(evnt) {
        setTimeout(function () {
          return autoResizeTextarea(evnt, renderOpts, params);
        }, 0);

        if (events && events[evnt.type]) {
          events[evnt.type](params, evnt);
        }
      };

      return [h('div', {
        "class": 'x-textarea--wrapper',
        style: {
          height: column.renderHeight - 1 + "px"
        }
      }, [h('textarea', {
        "class": 'x-textarea',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: xe_utils_1["default"].assign(getEvents(renderOpts, params), {
          cut: autoResizeEvent,
          paste: autoResizeEvent,
          drop: autoResizeEvent,
          focus: autoResizeEvent,
          keydown: function keydown(evnt) {
            if (evnt.keyCode === 13 && (!$table.keyboardConfig || evnt.altKey)) {
              evnt.preventDefault();
              evnt.stopPropagation();
              var inpElem_1 = evnt.target;
              var rangeData_1 = getCursorPosition(inpElem_1);
              var pos_1 = rangeData_1.end;
              var cellValue = inpElem_1.value;
              cellValue = cellValue.slice(0, pos_1) + "\n" + cellValue.slice(pos_1, cellValue.length);
              inpElem_1.value = cellValue;
              model.update = true;
              model.value = cellValue;
              setTimeout(function () {
                rangeData_1.start = rangeData_1.end = ++pos_1;
                setCursorPosition(inpElem_1, rangeData_1);
                autoResizeEvent(evnt);
              });
            } else {
              autoResizeEvent(evnt);
            }
          },
          compositionstart: autoResizeEvent,
          compositionupdate: autoResizeEvent,
          compositionend: autoResizeEvent
        })
      })])];
    },
    renderCell: function renderCell(h, renderOpts, params) {
      var row = params.row,
          column = params.column;
      return [h('span', {
        "class": 'x-textarea--content'
      }, xe_utils_1["default"].get(row, column.property))];
    }
  }
};
/**
 * 基于 vxe-table 表格的增强插件，提供一些常用的渲染器
 */

exports.VXETablePluginRenderer = {
  install: function install(xtable) {
    xtable.renderer.mixin(renderMap);
  }
};

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(exports.VXETablePluginRenderer);
}

exports["default"] = exports.VXETablePluginRenderer;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiaW5kZXgudHMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJ4ZV91dGlsc18xIiwicmVxdWlyZSIsImdldEN1cnNvclBvc2l0aW9uIiwidGV4dGFyZWEiLCJyYW5nZURhdGEiLCJ0ZXh0Iiwic3RhcnQiLCJlbmQiLCJzZXRTZWxlY3Rpb25SYW5nZSIsInNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uRW5kIiwic2V0Q3Vyc29yUG9zaXRpb24iLCJmb2N1cyIsIiR0ZXh0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiekluZGV4IiwicG9zaXRpb24iLCJhdXRvUmVzaXplVGV4dGFyZWEiLCJldm50IiwicmVuZGVyT3B0cyIsInBhcmFtcyIsIl9hIiwicHJvcHMiLCIkdGFibGUiLCJjb2x1bW4iLCJtaW5XaWR0aCIsInJlbmRlcldpZHRoIiwibWluSGVpZ2h0IiwicmVuZGVySGVpZ2h0IiwiaW5wRWxlbSIsInRhcmdldCIsIm1heFdpZHRoIiwibWF4SGVpZ2h0IiwidGV4dENvbnRlbnQiLCJ2YWx1ZSIsInBhcmVudE5vZGUiLCIkZWwiLCJhcHBlbmRDaGlsZCIsImhlaWdodCIsIk1hdGgiLCJtaW4iLCJvZmZzZXRIZWlnaHQiLCJ3aWR0aCIsIm1heCIsIm9mZnNldFdpZHRoIiwib3ZlcmZsb3dZIiwiZ2V0RXZlbnRzIiwiZXZlbnRzIiwibW9kZWwiLCJvbiIsImlucHV0IiwiY2VsbFZhbHVlIiwidXBkYXRlIiwidXBkYXRlU3RhdHVzIiwiYXNzaWduIiwib2JqZWN0TWFwIiwiY2IiLCJhcHBseSIsImNvbmNhdCIsImFyZ3VtZW50cyIsInJlbmRlck1hcCIsIlhJbnB1dCIsImF1dG9mb2N1cyIsInJlbmRlckVkaXQiLCJoIiwiYXR0cnMiLCJfYiIsInByZWZpeEljb24iLCJzdWZmaXhJY29uIiwicHJlZml4Q2xpY2siLCJzdWZmaXhDbGljayIsImNsaWNrIiwiZG9tUHJvcHMiLCJYVGV4dGFyZWEiLCJhdXRvUmVzaXplRXZlbnQiLCJzZXRUaW1lb3V0IiwidHlwZSIsImN1dCIsInBhc3RlIiwiZHJvcCIsImtleWRvd24iLCJrZXlDb2RlIiwia2V5Ym9hcmRDb25maWciLCJhbHRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImlucEVsZW1fMSIsInJhbmdlRGF0YV8xIiwicG9zXzEiLCJzbGljZSIsImxlbmd0aCIsImNvbXBvc2l0aW9uc3RhcnQiLCJjb21wb3NpdGlvbnVwZGF0ZSIsImNvbXBvc2l0aW9uZW5kIiwicmVuZGVyQ2VsbCIsInJvdyIsImdldCIsInByb3BlcnR5IiwiVlhFVGFibGVQbHVnaW5SZW5kZXJlciIsImluc3RhbGwiLCJ4dGFibGUiLCJyZW5kZXJlciIsIm1peGluIiwid2luZG93IiwiVlhFVGFibGUiLCJ1c2UiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7O0FDREEsSUFBQUMsVUFBQSxHQUFBQyxPQUFBLENBQUEsMkJBQUEsQ0FBQTs7QUFHQSxTQUFTQyxpQkFBVCxDQUE0QkMsUUFBNUIsRUFBeUQ7QUFDdkQsTUFBSUMsU0FBUyxHQUFHO0FBQUVDLElBQUFBLElBQUksRUFBRSxFQUFSO0FBQVlDLElBQUFBLEtBQUssRUFBRSxDQUFuQjtBQUFzQkMsSUFBQUEsR0FBRyxFQUFFO0FBQTNCLEdBQWhCOztBQUNBLE1BQUlKLFFBQVEsQ0FBQ0ssaUJBQWIsRUFBZ0M7QUFDOUJKLElBQUFBLFNBQVMsQ0FBQ0UsS0FBVixHQUFrQkgsUUFBUSxDQUFDTSxjQUEzQjtBQUNBTCxJQUFBQSxTQUFTLENBQUNHLEdBQVYsR0FBZ0JKLFFBQVEsQ0FBQ08sWUFBekI7QUFDRDs7QUFDRCxTQUFPTixTQUFQO0FBQ0Q7O0FBRUQsU0FBU08saUJBQVQsQ0FBNEJSLFFBQTVCLEVBQTJEQyxTQUEzRCxFQUF5RTtBQUN2RSxNQUFJRCxRQUFRLENBQUNLLGlCQUFiLEVBQWdDO0FBQzlCTCxJ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QUE4Q0QsS0ExRFE7QUEyRFRvQixJQUFBQSxVQUFVLEVBQVYsb0JBQVk5QixDQUFaLEVBQXlCN0MsVUFBekIsRUFBMENDLE1BQTFDLEVBQXFEO0FBQzdDLFVBQUEyRSxHQUFBLEdBQUEzRSxNQUFBLENBQUEyRSxHQUFBO0FBQUEsVUFBS3ZFLE1BQUEsR0FBQUosTUFBQSxDQUFBSSxNQUFMO0FBQ04sYUFBTyxDQUNMd0MsQ0FBQyxDQUFDLE1BQUQsRUFBUztBQUNSLGlCQUFPO0FBREMsT0FBVCxFQUVFcEUsVUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFRb0csR0FBUixDQUFZRCxHQUFaLEVBQWlCdkUsTUFBTSxDQUFDeUUsUUFBeEIsQ0FGRixDQURJLENBQVA7QUFLRDtBQWxFUTtBQS9DSyxDQUFsQjtBQXFIQTs7OztBQUdhdkcsT0FBQSxDQUFBd0csc0JBQUEsR0FBeUI7QUFDcENDLEVBQUFBLE9BQU8sRUFBUCxpQkFBU0MsTUFBVCxFQUFnQztBQUM5QkEsSUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxLQUFoQixDQUFzQjFDLFNBQXRCO0FBQ0Q7QUFIbUMsQ0FBekI7O0FBTWIsSUFBSSxPQUFPMkMsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDQyxRQUE1QyxFQUFzRDtBQUNwREQsRUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxHQUFoQixDQUFvQi9HLE9BQUEsQ0FBQXdHLHNCQUFwQjtBQUNEOztBQUVEeEcsT0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFlQSxPQUFBLENBQUF3RyxzQkFBZiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG52YXIgeGVfdXRpbHNfMSA9IHJlcXVpcmUoXCJ4ZS11dGlscy9tZXRob2RzL3hlLXV0aWxzXCIpO1xuZnVuY3Rpb24gZ2V0Q3Vyc29yUG9zaXRpb24odGV4dGFyZWEpIHtcbiAgICB2YXIgcmFuZ2VEYXRhID0geyB0ZXh0OiAnJywgc3RhcnQ6IDAsIGVuZDogMCB9O1xuICAgIGlmICh0ZXh0YXJlYS5zZXRTZWxlY3Rpb25SYW5nZSkge1xuICAgICAgICByYW5nZURhdGEuc3RhcnQgPSB0ZXh0YXJlYS5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgcmFuZ2VEYXRhLmVuZCA9IHRleHRhcmVhLnNlbGVjdGlvbkVuZDtcbiAgICB9XG4gICAgcmV0dXJuIHJhbmdlRGF0YTtcbn1cbmZ1bmN0aW9uIHNldEN1cnNvclBvc2l0aW9uKHRleHRhcmVhLCByYW5nZURhdGEpIHtcbiAgICBpZiAodGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcbiAgICAgICAgdGV4dGFyZWEuZm9jdXMoKTtcbiAgICAgICAgdGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UocmFuZ2VEYXRhLnN0YXJ0LCByYW5nZURhdGEuZW5kKTtcbiAgICB9XG59XG52YXIgJHRleHQ7XG5pZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICR0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICR0ZXh0LmNsYXNzTmFtZSA9ICd4LXRleHRhcmVhLS1yZXNpemUnO1xuICAgICR0ZXh0LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICAkdGV4dC5zdHlsZS56SW5kZXggPSAnLTEnO1xuICAgICR0ZXh0LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbn1cbmZ1bmN0aW9uIGF1dG9SZXNpemVUZXh0YXJlYShldm50LCByZW5kZXJPcHRzLCBwYXJhbXMpIHtcbiAgICB2YXIgX2EgPSByZW5kZXJPcHRzLnByb3BzLCBwcm9wcyA9IF9hID09PSB2b2lkIDAgPyB7fSA6IF9hO1xuICAgIHZhciAkdGFibGUgPSBwYXJhbXMuJHRhYmxlLCBjb2x1bW4gPSBwYXJhbXMuY29sdW1uO1xuICAgIHZhciBtaW5XaWR0aCA9IGNvbHVtbi5yZW5kZXJXaWR0aCwgbWluSGVpZ2h0ID0gY29sdW1uLnJlbmRlckhlaWdodDtcbiAgICB2YXIgaW5wRWxlbSA9IGV2bnQudGFyZ2V0O1xuICAgIC8vIGxldCBjZWxsID0gaW5wRWxlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUgPyBpbnBFbGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlIDogbnVsbFxuICAgIHZhciBtYXhXaWR0aCA9IHByb3BzLm1heFdpZHRoIHx8IDYwMDtcbiAgICB2YXIgbWF4SGVpZ2h0ID0gcHJvcHMubWF4SGVpZ2h0IHx8IDQwMDtcbiAgICAkdGV4dC50ZXh0Q29udGVudCA9IGlucEVsZW0udmFsdWUgKyBcIlxcblwiO1xuICAgICR0ZXh0LnN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGggKyBcInB4XCI7XG4gICAgaWYgKCEkdGV4dC5wYXJlbnROb2RlKSB7XG4gICAgICAgICR0YWJsZS4kZWwuYXBwZW5kQ2hpbGQoJHRleHQpO1xuICAgIH1cbiAgICB2YXIgaGVpZ2h0ID0gTWF0aC5taW4obWF4SGVpZ2h0LCAkdGV4dC5vZmZzZXRIZWlnaHQgKyA0KTtcbiAgICBpbnBFbGVtLnN0eWxlLndpZHRoID0gTWF0aC5taW4obWF4V2lkdGgsIE1hdGgubWF4KG1pbldpZHRoLCAkdGV4dC5vZmZzZXRXaWR0aCArIDIwKSkgKyBcInB4XCI7XG4gICAgaW5wRWxlbS5zdHlsZS5oZWlnaHQgPSAoaGVpZ2h0IDwgbWluSGVpZ2h0ID8gbWluSGVpZ2h0IDogaGVpZ2h0KSArIFwicHhcIjtcbiAgICBpbnBFbGVtLnN0eWxlLm92ZXJmbG93WSA9IGhlaWdodCA+IG1heFdpZHRoID8gJ2F1dG8nIDogJyc7XG59XG5mdW5jdGlvbiBnZXRFdmVudHMocmVuZGVyT3B0cywgcGFyYW1zKSB7XG4gICAgdmFyIGV2ZW50cyA9IHJlbmRlck9wdHMuZXZlbnRzO1xuICAgIHZhciAkdGFibGUgPSBwYXJhbXMuJHRhYmxlLCBjb2x1bW4gPSBwYXJhbXMuY29sdW1uO1xuICAgIHZhciBtb2RlbCA9IGNvbHVtbi5tb2RlbDtcbiAgICB2YXIgb24gPSB7XG4gICAgICAgIGlucHV0OiBmdW5jdGlvbiAoZXZudCkge1xuICAgICAgICAgICAgdmFyIGNlbGxWYWx1ZSA9IGV2bnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgbW9kZWwudXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vZGVsLnZhbHVlID0gY2VsbFZhbHVlO1xuICAgICAgICAgICAgJHRhYmxlLnVwZGF0ZVN0YXR1cyhwYXJhbXMsIGNlbGxWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGlmIChldmVudHMpIHtcbiAgICAgICAgeGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uYXNzaWduKG9uLCB4ZV91dGlsc18xW1wiZGVmYXVsdFwiXS5vYmplY3RNYXAoZXZlbnRzLCBmdW5jdGlvbiAoY2IpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNiLmFwcGx5KG51bGwsIFtwYXJhbXNdLmNvbmNhdC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykpO1xuICAgICAgICB9OyB9KSk7XG4gICAgfVxuICAgIHJldHVybiBvbjtcbn1cbi8qKlxuICog5riy5p+T5Ye95pWwXG4gKi9cbnZhciByZW5kZXJNYXAgPSB7XG4gICAgWElucHV0OiB7XG4gICAgICAgIGF1dG9mb2N1czogJy54LWlucHV0JyxcbiAgICAgICAgcmVuZGVyRWRpdDogZnVuY3Rpb24gKGgsIHJlbmRlck9wdHMsIHBhcmFtcykge1xuICAgICAgICAgICAgdmFyIF9hID0gcmVuZGVyT3B0cy5wcm9wcywgcHJvcHMgPSBfYSA9PT0gdm9pZCAwID8ge30gOiBfYSwgYXR0cnMgPSByZW5kZXJPcHRzLmF0dHJzLCBfYiA9IHJlbmRlck9wdHMuZXZlbnRzLCBldmVudHMgPSBfYiA9PT0gdm9pZCAwID8ge30gOiBfYjtcbiAgICAgICAgICAgIHZhciBjb2x1bW4gPSBwYXJhbXMuY29sdW1uO1xuICAgICAgICAgICAgdmFyIG1vZGVsID0gY29sdW1uLm1vZGVsO1xuICAgICAgICAgICAgdmFyIHByZWZpeEljb24gPSBwcm9wcy5wcmVmaXhJY29uLCBzdWZmaXhJY29uID0gcHJvcHMuc3VmZml4SWNvbjtcbiAgICAgICAgICAgIHZhciBwcmVmaXhDbGljayA9IGV2ZW50cy5wcmVmaXhDbGljaywgc3VmZml4Q2xpY2sgPSBldmVudHMuc3VmZml4Q2xpY2s7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGgoJ2RpdicsIHtcbiAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiOiBbJ3gtaW5wdXQtLXdyYXBwZXInLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzLS1wcmVmaXgnOiBwcm9wcy5wcmVmaXhJY29uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpcy0tc3VmZml4JzogcHJvcHMuc3VmZml4SWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGNvbHVtbi5yZW5kZXJIZWlnaHQgLSAxICsgXCJweFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBbXG4gICAgICAgICAgICAgICAgICAgIHByZWZpeEljb24gPyBoKCdpJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiOiBbJ3gtaW5wdXQtLXByZWZpeCcsIHByZWZpeEljb24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzLS10cmlnZ2VyJzogcHJlZml4Q2xpY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uOiBwcmVmaXhDbGljayA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGV2bnQpIHsgcmV0dXJuIHByZWZpeENsaWNrKHBhcmFtcywgZXZudCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH0pIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgaCgnaW5wdXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImNsYXNzXCI6ICd4LWlucHV0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzOiBhdHRycyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbVByb3BzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG1vZGVsLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgb246IGdldEV2ZW50cyhyZW5kZXJPcHRzLCBwYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBzdWZmaXhJY29uID8gaCgnaScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogWyd4LWlucHV0LS1zdWZmaXgnLCBzdWZmaXhJY29uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpcy0tdHJpZ2dlcic6IHN1ZmZpeENsaWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogc3VmZml4Q2xpY2sgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIChldm50KSB7IHJldHVybiBzdWZmaXhDbGljayhwYXJhbXMsIGV2bnQpOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KSA6IG51bGxcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgWFRleHRhcmVhOiB7XG4gICAgICAgIGF1dG9mb2N1czogJy54LXRleHRhcmVhJyxcbiAgICAgICAgcmVuZGVyRWRpdDogZnVuY3Rpb24gKGgsIHJlbmRlck9wdHMsIHBhcmFtcykge1xuICAgICAgICAgICAgdmFyIGF0dHJzID0gcmVuZGVyT3B0cy5hdHRycywgZXZlbnRzID0gcmVuZGVyT3B0cy5ldmVudHM7XG4gICAgICAgICAgICB2YXIgJHRhYmxlID0gcGFyYW1zLiR0YWJsZSwgY29sdW1uID0gcGFyYW1zLmNvbHVtbjtcbiAgICAgICAgICAgIHZhciBtb2RlbCA9IGNvbHVtbi5tb2RlbDtcbiAgICAgICAgICAgIHZhciBhdXRvUmVzaXplRXZlbnQgPSBmdW5jdGlvbiAoZXZudCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gYXV0b1Jlc2l6ZVRleHRhcmVhKGV2bnQsIHJlbmRlck9wdHMsIHBhcmFtcyk7IH0sIDApO1xuICAgICAgICAgICAgICAgIGlmIChldmVudHMgJiYgZXZlbnRzW2V2bnQudHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRzW2V2bnQudHlwZV0ocGFyYW1zLCBldm50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBoKCdkaXYnLCB7XG4gICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogJ3gtdGV4dGFyZWEtLXdyYXBwZXInLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBjb2x1bW4ucmVuZGVySGVpZ2h0IC0gMSArIFwicHhcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgW1xuICAgICAgICAgICAgICAgICAgICBoKCd0ZXh0YXJlYScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogJ3gtdGV4dGFyZWEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IGF0dHJzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tUHJvcHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbW9kZWwudmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvbjogeGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uYXNzaWduKGdldEV2ZW50cyhyZW5kZXJPcHRzLCBwYXJhbXMpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3V0OiBhdXRvUmVzaXplRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGU6IGF1dG9SZXNpemVFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wOiBhdXRvUmVzaXplRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXM6IGF1dG9SZXNpemVFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlkb3duOiBmdW5jdGlvbiAoZXZudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZudC5rZXlDb2RlID09PSAxMyAmJiAoISR0YWJsZS5rZXlib2FyZENvbmZpZyB8fCBldm50LmFsdEtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2bnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2bnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5wRWxlbV8xID0gZXZudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2VEYXRhXzEgPSBnZXRDdXJzb3JQb3NpdGlvbihpbnBFbGVtXzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc18xID0gcmFuZ2VEYXRhXzEuZW5kO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGxWYWx1ZSA9IGlucEVsZW1fMS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxWYWx1ZSA9IGNlbGxWYWx1ZS5zbGljZSgwLCBwb3NfMSkgKyBcIlxcblwiICsgY2VsbFZhbHVlLnNsaWNlKHBvc18xLCBjZWxsVmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucEVsZW1fMS52YWx1ZSA9IGNlbGxWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnVwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC52YWx1ZSA9IGNlbGxWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlRGF0YV8xLnN0YXJ0ID0gcmFuZ2VEYXRhXzEuZW5kID0gKytwb3NfMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDdXJzb3JQb3NpdGlvbihpbnBFbGVtXzEsIHJhbmdlRGF0YV8xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvUmVzaXplRXZlbnQoZXZudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9SZXNpemVFdmVudChldm50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRpb25zdGFydDogYXV0b1Jlc2l6ZUV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0aW9udXBkYXRlOiBhdXRvUmVzaXplRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRpb25lbmQ6IGF1dG9SZXNpemVFdmVudFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyQ2VsbDogZnVuY3Rpb24gKGgsIHJlbmRlck9wdHMsIHBhcmFtcykge1xuICAgICAgICAgICAgdmFyIHJvdyA9IHBhcmFtcy5yb3csIGNvbHVtbiA9IHBhcmFtcy5jb2x1bW47XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGgoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogJ3gtdGV4dGFyZWEtLWNvbnRlbnQnXG4gICAgICAgICAgICAgICAgfSwgeGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG59O1xuLyoqXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWinuW8uuaPkuS7tu+8jOaPkOS+m+S4gOS6m+W4uOeUqOeahOa4suafk+WZqFxuICovXG5leHBvcnRzLlZYRVRhYmxlUGx1Z2luUmVuZGVyZXIgPSB7XG4gICAgaW5zdGFsbDogZnVuY3Rpb24gKHh0YWJsZSkge1xuICAgICAgICB4dGFibGUucmVuZGVyZXIubWl4aW4ocmVuZGVyTWFwKTtcbiAgICB9XG59O1xuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xuICAgIHdpbmRvdy5WWEVUYWJsZS51c2UoZXhwb3J0cy5WWEVUYWJsZVBsdWdpblJlbmRlcmVyKTtcbn1cbmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gZXhwb3J0cy5WWEVUYWJsZVBsdWdpblJlbmRlcmVyO1xuIiwiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMvbWV0aG9kcy94ZS11dGlscydcclxuaW1wb3J0IHsgVlhFVGFibGUgfSBmcm9tICd2eGUtdGFibGUnXHJcblxyXG5mdW5jdGlvbiBnZXRDdXJzb3JQb3NpdGlvbiAodGV4dGFyZWE6IEhUTUxUZXh0QXJlYUVsZW1lbnQpIHtcclxuICBsZXQgcmFuZ2VEYXRhID0geyB0ZXh0OiAnJywgc3RhcnQ6IDAsIGVuZDogMCB9XHJcbiAgaWYgKHRleHRhcmVhLnNldFNlbGVjdGlvblJhbmdlKSB7XHJcbiAgICByYW5nZURhdGEuc3RhcnQgPSB0ZXh0YXJlYS5zZWxlY3Rpb25TdGFydFxyXG4gICAgcmFuZ2VEYXRhLmVuZCA9IHRleHRhcmVhLnNlbGVjdGlvbkVuZFxyXG4gIH1cclxuICByZXR1cm4gcmFuZ2VEYXRhXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEN1cnNvclBvc2l0aW9uICh0ZXh0YXJlYTogSFRNTFRleHRBcmVhRWxlbWVudCwgcmFuZ2VEYXRhOiBhbnkpIHtcclxuICBpZiAodGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcclxuICAgIHRleHRhcmVhLmZvY3VzKClcclxuICAgIHRleHRhcmVhLnNldFNlbGVjdGlvblJhbmdlKHJhbmdlRGF0YS5zdGFydCwgcmFuZ2VEYXRhLmVuZClcclxuICB9XHJcbn1cclxuXHJcbnZhciAkdGV4dDogSFRNTFNwYW5FbGVtZW50XHJcbmlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgJHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcclxuICAkdGV4dC5jbGFzc05hbWUgPSAneC10ZXh0YXJlYS0tcmVzaXplJ1xyXG4gICR0ZXh0LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJ1xyXG4gICR0ZXh0LnN0eWxlLnpJbmRleCA9ICctMSdcclxuICAkdGV4dC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcclxufVxyXG5cclxuZnVuY3Rpb24gYXV0b1Jlc2l6ZVRleHRhcmVhIChldm50OiBhbnksIHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICBsZXQgeyBwcm9wcyA9IHt9IH0gPSByZW5kZXJPcHRzXHJcbiAgbGV0IHsgJHRhYmxlLCBjb2x1bW4gfSA9IHBhcmFtc1xyXG4gIGxldCB7IHJlbmRlcldpZHRoOiBtaW5XaWR0aCwgcmVuZGVySGVpZ2h0OiBtaW5IZWlnaHQgfSA9IGNvbHVtblxyXG4gIGxldCBpbnBFbGVtID0gZXZudC50YXJnZXRcclxuICAvLyBsZXQgY2VsbCA9IGlucEVsZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlID8gaW5wRWxlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZSA6IG51bGxcclxuICBsZXQgbWF4V2lkdGggPSBwcm9wcy5tYXhXaWR0aCB8fCA2MDBcclxuICBsZXQgbWF4SGVpZ2h0ID0gcHJvcHMubWF4SGVpZ2h0IHx8IDQwMFxyXG4gICR0ZXh0LnRleHRDb250ZW50ID0gYCR7aW5wRWxlbS52YWx1ZX1cXG5gXHJcbiAgJHRleHQuc3R5bGUubWF4V2lkdGggPSBgJHttYXhXaWR0aH1weGBcclxuICBpZiAoISR0ZXh0LnBhcmVudE5vZGUpIHtcclxuICAgICR0YWJsZS4kZWwuYXBwZW5kQ2hpbGQoJHRleHQpXHJcbiAgfVxyXG4gIGxldCBoZWlnaHQgPSBNYXRoLm1pbihtYXhIZWlnaHQsICR0ZXh0Lm9mZnNldEhlaWdodCArIDQpXHJcbiAgaW5wRWxlbS5zdHlsZS53aWR0aCA9IGAke01hdGgubWluKG1heFdpZHRoLCBNYXRoLm1heChtaW5XaWR0aCwgJHRleHQub2Zmc2V0V2lkdGggKyAyMCkpfXB4YFxyXG4gIGlucEVsZW0uc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0IDwgbWluSGVpZ2h0ID8gbWluSGVpZ2h0IDogaGVpZ2h0fXB4YFxyXG4gIGlucEVsZW0uc3R5bGUub3ZlcmZsb3dZID0gaGVpZ2h0ID4gbWF4V2lkdGggPyAnYXV0bycgOiAnJ1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRFdmVudHMgKHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICBsZXQgeyBldmVudHMgfSA9IHJlbmRlck9wdHNcclxuICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgbGV0IHsgbW9kZWwgfSA9IGNvbHVtblxyXG4gIGxldCBvbiA9IHtcclxuICAgIGlucHV0IChldm50OiBhbnkpIHtcclxuICAgICAgbGV0IGNlbGxWYWx1ZSA9IGV2bnQudGFyZ2V0LnZhbHVlXHJcbiAgICAgIG1vZGVsLnVwZGF0ZSA9IHRydWVcclxuICAgICAgbW9kZWwudmFsdWUgPSBjZWxsVmFsdWVcclxuICAgICAgJHRhYmxlLnVwZGF0ZVN0YXR1cyhwYXJhbXMsIGNlbGxWYWx1ZSlcclxuICAgIH1cclxuICB9XHJcbiAgaWYgKGV2ZW50cykge1xyXG4gICAgWEVVdGlscy5hc3NpZ24ob24sIFhFVXRpbHMub2JqZWN0TWFwKGV2ZW50cywgKGNiOiBGdW5jdGlvbikgPT4gZnVuY3Rpb24gKCkge1xyXG4gICAgICBjYi5hcHBseShudWxsLCBbcGFyYW1zXS5jb25jYXQuYXBwbHkocGFyYW1zLCBhcmd1bWVudHMpKVxyXG4gICAgfSkpXHJcbiAgfVxyXG4gIHJldHVybiBvblxyXG59XHJcblxyXG4vKipcclxuICog5riy5p+T5Ye95pWwXHJcbiAqL1xyXG5jb25zdCByZW5kZXJNYXAgPSB7XHJcbiAgWElucHV0OiB7XHJcbiAgICBhdXRvZm9jdXM6ICcueC1pbnB1dCcsXHJcbiAgICByZW5kZXJFZGl0IChoOiBGdW5jdGlvbiwgcmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gICAgICBsZXQgeyBwcm9wcyA9IHt9LCBhdHRycywgZXZlbnRzID0ge30gfSA9IHJlbmRlck9wdHNcclxuICAgICAgbGV0IHsgY29sdW1uIH0gPSBwYXJhbXNcclxuICAgICAgbGV0IHsgbW9kZWwgfSA9IGNvbHVtblxyXG4gICAgICBsZXQgeyBwcmVmaXhJY29uLCBzdWZmaXhJY29uIH0gPSBwcm9wc1xyXG4gICAgICBsZXQgeyBwcmVmaXhDbGljaywgc3VmZml4Q2xpY2sgfSA9IGV2ZW50c1xyXG4gICAgICByZXR1cm4gW1xyXG4gICAgICAgIGgoJ2RpdicsIHtcclxuICAgICAgICAgIGNsYXNzOiBbJ3gtaW5wdXQtLXdyYXBwZXInLCB7XHJcbiAgICAgICAgICAgICdpcy0tcHJlZml4JzogcHJvcHMucHJlZml4SWNvbixcclxuICAgICAgICAgICAgJ2lzLS1zdWZmaXgnOiBwcm9wcy5zdWZmaXhJY29uXHJcbiAgICAgICAgICB9XSxcclxuICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgIGhlaWdodDogYCR7Y29sdW1uLnJlbmRlckhlaWdodCAtIDF9cHhgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgW1xyXG4gICAgICAgICAgcHJlZml4SWNvbiA/IGgoJ2knLCB7XHJcbiAgICAgICAgICAgIGNsYXNzOiBbJ3gtaW5wdXQtLXByZWZpeCcsIHByZWZpeEljb24sIHtcclxuICAgICAgICAgICAgICAnaXMtLXRyaWdnZXInOiBwcmVmaXhDbGlja1xyXG4gICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgb246IHByZWZpeENsaWNrID8ge1xyXG4gICAgICAgICAgICAgIGNsaWNrOiAoZXZudDogYW55KSA9PiBwcmVmaXhDbGljayhwYXJhbXMsIGV2bnQpXHJcbiAgICAgICAgICAgIH0gOiBudWxsXHJcbiAgICAgICAgICB9KSA6IG51bGwsXHJcbiAgICAgICAgICBoKCdpbnB1dCcsIHtcclxuICAgICAgICAgICAgY2xhc3M6ICd4LWlucHV0JyxcclxuICAgICAgICAgICAgYXR0cnMsXHJcbiAgICAgICAgICAgIGRvbVByb3BzOiB7XHJcbiAgICAgICAgICAgICAgdmFsdWU6IG1vZGVsLnZhbHVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uOiBnZXRFdmVudHMocmVuZGVyT3B0cywgcGFyYW1zKVxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBzdWZmaXhJY29uID8gaCgnaScsIHtcclxuICAgICAgICAgICAgY2xhc3M6IFsneC1pbnB1dC0tc3VmZml4Jywgc3VmZml4SWNvbiwge1xyXG4gICAgICAgICAgICAgICdpcy0tdHJpZ2dlcic6IHN1ZmZpeENsaWNrXHJcbiAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBvbjogc3VmZml4Q2xpY2sgPyB7XHJcbiAgICAgICAgICAgICAgY2xpY2s6IChldm50OiBhbnkpID0+IHN1ZmZpeENsaWNrKHBhcmFtcywgZXZudClcclxuICAgICAgICAgICAgfSA6IG51bGxcclxuICAgICAgICAgIH0pIDogbnVsbFxyXG4gICAgICAgIF0pXHJcbiAgICAgIF1cclxuICAgIH1cclxuICB9LFxyXG4gIFhUZXh0YXJlYToge1xyXG4gICAgYXV0b2ZvY3VzOiAnLngtdGV4dGFyZWEnLFxyXG4gICAgcmVuZGVyRWRpdCAoaDogRnVuY3Rpb24sIHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICAgICAgbGV0IHsgYXR0cnMsIGV2ZW50cyB9ID0gcmVuZGVyT3B0c1xyXG4gICAgICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgICAgIGxldCB7IG1vZGVsIH0gPSBjb2x1bW5cclxuICAgICAgbGV0IGF1dG9SZXNpemVFdmVudCA9IChldm50OiBhbnkpID0+IHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGF1dG9SZXNpemVUZXh0YXJlYShldm50LCByZW5kZXJPcHRzLCBwYXJhbXMpLCAwKVxyXG4gICAgICAgIGlmIChldmVudHMgJiYgZXZlbnRzW2V2bnQudHlwZV0pIHtcclxuICAgICAgICAgIGV2ZW50c1tldm50LnR5cGVdKHBhcmFtcywgZXZudClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICBoKCdkaXYnLCB7XHJcbiAgICAgICAgICBjbGFzczogJ3gtdGV4dGFyZWEtLXdyYXBwZXInLFxyXG4gICAgICAgICAgc3R5bGU6IHtcclxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtjb2x1bW4ucmVuZGVySGVpZ2h0IC0gMX1weGBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBbXHJcbiAgICAgICAgICBoKCd0ZXh0YXJlYScsIHtcclxuICAgICAgICAgICAgY2xhc3M6ICd4LXRleHRhcmVhJyxcclxuICAgICAgICAgICAgYXR0cnMsXHJcbiAgICAgICAgICAgIGRvbVByb3BzOiB7XHJcbiAgICAgICAgICAgICAgdmFsdWU6IG1vZGVsLnZhbHVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uOiBYRVV0aWxzLmFzc2lnbihnZXRFdmVudHMocmVuZGVyT3B0cywgcGFyYW1zKSwge1xyXG4gICAgICAgICAgICAgIGN1dDogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIHBhc3RlOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAgZHJvcDogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIGZvY3VzOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAga2V5ZG93biAoZXZudDogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZudC5rZXlDb2RlID09PSAxMyAmJiAoISR0YWJsZS5rZXlib2FyZENvbmZpZyB8fCBldm50LmFsdEtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgZXZudC5wcmV2ZW50RGVmYXVsdCgpXHJcbiAgICAgICAgICAgICAgICAgIGV2bnQuc3RvcFByb3BhZ2F0aW9uKClcclxuICAgICAgICAgICAgICAgICAgbGV0IGlucEVsZW0gPSBldm50LnRhcmdldFxyXG4gICAgICAgICAgICAgICAgICBsZXQgcmFuZ2VEYXRhID0gZ2V0Q3Vyc29yUG9zaXRpb24oaW5wRWxlbSlcclxuICAgICAgICAgICAgICAgICAgbGV0IHBvcyA9IHJhbmdlRGF0YS5lbmRcclxuICAgICAgICAgICAgICAgICAgbGV0IGNlbGxWYWx1ZSA9IGlucEVsZW0udmFsdWVcclxuICAgICAgICAgICAgICAgICAgY2VsbFZhbHVlID0gYCR7Y2VsbFZhbHVlLnNsaWNlKDAsIHBvcyl9XFxuJHtjZWxsVmFsdWUuc2xpY2UocG9zLCBjZWxsVmFsdWUubGVuZ3RoKX1gXHJcbiAgICAgICAgICAgICAgICAgIGlucEVsZW0udmFsdWUgPSBjZWxsVmFsdWVcclxuICAgICAgICAgICAgICAgICAgbW9kZWwudXBkYXRlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICBtb2RlbC52YWx1ZSA9IGNlbGxWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByYW5nZURhdGEuc3RhcnQgPSByYW5nZURhdGEuZW5kID0gKytwb3NcclxuICAgICAgICAgICAgICAgICAgICBzZXRDdXJzb3JQb3NpdGlvbihpbnBFbGVtLCByYW5nZURhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgYXV0b1Jlc2l6ZUV2ZW50KGV2bnQpXHJcbiAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBhdXRvUmVzaXplRXZlbnQoZXZudClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIGNvbXBvc2l0aW9uc3RhcnQ6IGF1dG9SZXNpemVFdmVudCxcclxuICAgICAgICAgICAgICBjb21wb3NpdGlvbnVwZGF0ZTogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIGNvbXBvc2l0aW9uZW5kOiBhdXRvUmVzaXplRXZlbnRcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgXSlcclxuICAgICAgXVxyXG4gICAgfSxcclxuICAgIHJlbmRlckNlbGwgKGg6IEZ1bmN0aW9uLCByZW5kZXJPcHRzOiBhbnksIHBhcmFtczogYW55KSB7XHJcbiAgICAgIGxldCB7IHJvdywgY29sdW1uIH0gPSBwYXJhbXNcclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICBoKCdzcGFuJywge1xyXG4gICAgICAgICAgY2xhc3M6ICd4LXRleHRhcmVhLS1jb250ZW50J1xyXG4gICAgICAgIH0sIFhFVXRpbHMuZ2V0KHJvdywgY29sdW1uLnByb3BlcnR5KSlcclxuICAgICAgXVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5o+Q5L6b5LiA5Lqb5bi455So55qE5riy5p+T5ZmoXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5SZW5kZXJlciA9IHtcclxuICBpbnN0YWxsICh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgeHRhYmxlLnJlbmRlcmVyLm1peGluKHJlbmRlck1hcClcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luUmVuZGVyZXIpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luUmVuZGVyZXJcclxuIl19

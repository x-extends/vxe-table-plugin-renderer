"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginRenderer = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// import { VXETable } from 'vxe-table'
function getCursorPosition(textarea) {
  var rangeData = {
    text: '',
    start: 0,
    end: 0
  };

  if (textarea.setSelectionRange) {
    rangeData.start = textarea.selectionStart;
    rangeData.end = textarea.selectionEnd;
  }

  return rangeData;
}

function setCursorPosition(textarea, rangeData) {
  if (textarea.setSelectionRange) {
    textarea.focus();
    textarea.setSelectionRange(rangeData.start, rangeData.end);
  }
}

var $text;

if (typeof document !== 'undefined') {
  $text = document.createElement('span');
  $text.className = 'x-textarea--resize';
  $text.style.visibility = 'hidden';
  $text.style.zIndex = '-1';
  $text.style.position = 'absolute';
}

function autoResizeTextarea(evnt, renderOpts, params) {
  var _renderOpts$props = renderOpts.props,
      props = _renderOpts$props === void 0 ? {} : _renderOpts$props;
  var $table = params.$table,
      column = params.column;
  var minWidth = column.renderWidth,
      minHeight = column.renderHeight;
  var inpElem = evnt.target; // let cell = inpElem.parentNode.parentNode ? inpElem.parentNode.parentNode.parentNode : null

  var maxWidth = props.maxWidth || 600;
  var maxHeight = props.maxHeight || 400;
  $text.textContent = "".concat(inpElem.value, "\n");
  $text.style.maxWidth = "".concat(maxWidth, "px");

  if (!$text.parentNode) {
    $table.$el.appendChild($text);
  }

  var height = Math.min(maxHeight, $text.offsetHeight + 4);
  inpElem.style.width = "".concat(Math.min(maxWidth, Math.max(minWidth, $text.offsetWidth + 20)), "px");
  inpElem.style.height = "".concat(height < minHeight ? minHeight : height, "px");
  inpElem.style.overflowY = height > maxWidth ? 'auto' : '';
}

function getEvents(renderOpts, params) {
  var events = renderOpts.events;
  var $table = params.$table,
      column = params.column;
  var model = column.model;
  var on = {
    input: function input(evnt) {
      var cellValue = evnt.target.value;
      model.update = true;
      model.value = cellValue;
      $table.updateStatus(params, cellValue);
    }
  };

  if (events) {
    _xeUtils["default"].assign(on, _xeUtils["default"].objectMap(events, function (cb) {
      return function () {
        cb.apply(null, [params].concat.apply(params, arguments));
      };
    }));
  }

  return on;
}
/**
 * 渲染函数
 */


var renderMap = {
  XInput: {
    autofocus: '.x-input',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var _renderOpts$props2 = renderOpts.props,
          props = _renderOpts$props2 === void 0 ? {} : _renderOpts$props2,
          attrs = renderOpts.attrs,
          _renderOpts$events = renderOpts.events,
          events = _renderOpts$events === void 0 ? {} : _renderOpts$events;
      var column = params.column;
      var model = column.model;
      var prefixIcon = props.prefixIcon,
          suffixIcon = props.suffixIcon;
      var prefixClick = events.prefixClick,
          suffixClick = events.suffixClick;
      return [h('div', {
        "class": ['x-input--wrapper', {
          'is--prefix': props.prefixIcon,
          'is--suffix': props.suffixIcon
        }],
        style: {
          height: "".concat(column.renderHeight - 1, "px")
        }
      }, [prefixIcon ? h('i', {
        "class": ['x-input--prefix', prefixIcon, {
          'is--trigger': prefixClick
        }],
        on: prefixClick ? {
          click: function click(evnt) {
            return prefixClick(params, evnt);
          }
        } : null
      }) : null, h('input', {
        "class": 'x-input',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: getEvents(renderOpts, params)
      }), suffixIcon ? h('i', {
        "class": ['x-input--suffix', suffixIcon, {
          'is--trigger': suffixClick
        }],
        on: suffixClick ? {
          click: function click(evnt) {
            return suffixClick(params, evnt);
          }
        } : null
      }) : null])];
    }
  },
  XTextarea: {
    autofocus: '.x-textarea',
    renderEdit: function renderEdit(h, renderOpts, params) {
      var attrs = renderOpts.attrs,
          events = renderOpts.events;
      var $table = params.$table,
          column = params.column;
      var model = column.model;

      var autoResizeEvent = function autoResizeEvent(evnt) {
        setTimeout(function () {
          return autoResizeTextarea(evnt, renderOpts, params);
        }, 0);

        if (events && events[evnt.type]) {
          events[evnt.type](params, evnt);
        }
      };

      return [h('div', {
        "class": 'x-textarea--wrapper',
        style: {
          height: "".concat(column.renderHeight - 1, "px")
        }
      }, [h('textarea', {
        "class": 'x-textarea',
        attrs: attrs,
        domProps: {
          value: model.value
        },
        on: _xeUtils["default"].assign(getEvents(renderOpts, params), {
          cut: autoResizeEvent,
          paste: autoResizeEvent,
          drop: autoResizeEvent,
          focus: autoResizeEvent,
          keydown: function keydown(evnt) {
            if (evnt.keyCode === 13 && (!$table.keyboardConfig || evnt.altKey)) {
              evnt.preventDefault();
              evnt.stopPropagation();
              var inpElem = evnt.target;
              var rangeData = getCursorPosition(inpElem);
              var pos = rangeData.end;
              var cellValue = inpElem.value;
              cellValue = "".concat(cellValue.slice(0, pos), "\n").concat(cellValue.slice(pos, cellValue.length));
              inpElem.value = cellValue;
              model.update = true;
              model.value = cellValue;
              setTimeout(function () {
                rangeData.start = rangeData.end = ++pos;
                setCursorPosition(inpElem, rangeData);
                autoResizeEvent(evnt);
              });
            } else {
              autoResizeEvent(evnt);
            }
          },
          compositionstart: autoResizeEvent,
          compositionupdate: autoResizeEvent,
          compositionend: autoResizeEvent
        })
      })])];
    },
    renderCell: function renderCell(h, renderOpts, params) {
      var row = params.row,
          column = params.column;
      return [h('span', {
        "class": 'x-textarea--content'
      }, _xeUtils["default"].get(row, column.property))];
    }
  }
};
/**
 * 基于 vxe-table 表格的增强插件，提供一些常用的渲染器
 */

var VXETablePluginRenderer = {
  install: function install(xtable) {
    xtable.renderer.mixin(renderMap);
  }
};
exports.VXETablePluginRenderer = VXETablePluginRenderer;

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginRenderer);
}

var _default = VXETablePluginRenderer;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImdldEN1cnNvclBvc2l0aW9uIiwidGV4dGFyZWEiLCJyYW5nZURhdGEiLCJ0ZXh0Iiwic3RhcnQiLCJlbmQiLCJzZXRTZWxlY3Rpb25SYW5nZSIsInNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uRW5kIiwic2V0Q3Vyc29yUG9zaXRpb24iLCJmb2N1cyIsIiR0ZXh0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiekluZGV4IiwicG9zaXRpb24iLCJhdXRvUmVzaXplVGV4dGFyZWEiLCJldm50IiwicmVuZGVyT3B0cyIsInBhcmFtcyIsInByb3BzIiwiJHRhYmxlIiwiY29sdW1uIiwibWluV2lkdGgiLCJyZW5kZXJXaWR0aCIsIm1pbkhlaWdodCIsInJlbmRlckhlaWdodCIsImlucEVsZW0iLCJ0YXJnZXQiLCJtYXhXaWR0aCIsIm1heEhlaWdodCIsInRleHRDb250ZW50IiwidmFsdWUiLCJwYXJlbnROb2RlIiwiJGVsIiwiYXBwZW5kQ2hpbGQiLCJoZWlnaHQiLCJNYXRoIiwibWluIiwib2Zmc2V0SGVpZ2h0Iiwid2lkdGgiLCJtYXgiLCJvZmZzZXRXaWR0aCIsIm92ZXJmbG93WSIsImdldEV2ZW50cyIsImV2ZW50cyIsIm1vZGVsIiwib24iLCJpbnB1dCIsImNlbGxWYWx1ZSIsInVwZGF0ZSIsInVwZGF0ZVN0YXR1cyIsIlhFVXRpbHMiLCJhc3NpZ24iLCJvYmplY3RNYXAiLCJjYiIsImFwcGx5IiwiY29uY2F0IiwiYXJndW1lbnRzIiwicmVuZGVyTWFwIiwiWElucHV0IiwiYXV0b2ZvY3VzIiwicmVuZGVyRWRpdCIsImgiLCJhdHRycyIsInByZWZpeEljb24iLCJzdWZmaXhJY29uIiwicHJlZml4Q2xpY2siLCJzdWZmaXhDbGljayIsImNsaWNrIiwiZG9tUHJvcHMiLCJYVGV4dGFyZWEiLCJhdXRvUmVzaXplRXZlbnQiLCJzZXRUaW1lb3V0IiwidHlwZSIsImN1dCIsInBhc3RlIiwiZHJvcCIsImtleWRvd24iLCJrZXlDb2RlIiwia2V5Ym9hcmRDb25maWciLCJhbHRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsInBvcyIsInNsaWNlIiwibGVuZ3RoIiwiY29tcG9zaXRpb25zdGFydCIsImNvbXBvc2l0aW9udXBkYXRlIiwiY29tcG9zaXRpb25lbmQiLCJyZW5kZXJDZWxsIiwicm93IiwiZ2V0IiwicHJvcGVydHkiLCJWWEVUYWJsZVBsdWdpblJlbmRlcmVyIiwiaW5zdGFsbCIsInh0YWJsZSIsInJlbmRlcmVyIiwibWl4aW4iLCJ3aW5kb3ciLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBQ0E7QUFFQSxTQUFTQSxpQkFBVCxDQUE0QkMsUUFBNUIsRUFBeUQ7QUFDdkQsTUFBSUMsU0FBUyxHQUFHO0FBQUVDLElBQUFBLElBQUksRUFBRSxFQUFSO0FBQVlDLElBQUFBLEtBQUssRUFBRSxDQUFuQjtBQUFzQkMsSUFBQUEsR0FBRyxFQUFFO0FBQTNCLEdBQWhCOztBQUNBLE1BQUlKLFFBQVEsQ0FBQ0ssaUJBQWIsRUFBZ0M7QUFDOUJKLElBQUFBLFNBQVMsQ0FBQ0UsS0FBVixHQUFrQkgsUUFBUSxDQUFDTSxjQUEzQjtBQUNBTCxJQUFBQSxTQUFTLENBQUNHLEdBQVYsR0FBZ0JKLFFBQVEsQ0FBQ08sWUFBekI7QUFDRDs7QUFDRCxTQUFPTixTQUFQO0FBQ0Q7O0FBRUQsU0FBU08saUJBQVQsQ0FBNEJSLFFBQTVCLEVBQTJEQyxTQUEzRCxFQUF5RTtBQUN2RSxNQUFJRCxRQUFRLENBQUNLLGlCQUFiLEVBQWdDO0FBQzlCTCxJQUFBQSxRQUFRLENBQUNTLEtBQVQ7QUFDQVQsSUFBQUEsUUFBUSxDQUFDSyxpQkFBVCxDQUEyQkosU0FBUyxDQUFDRSxLQUFyQyxFQUE0Q0YsU0FBUyxDQUFDRyxHQUF0RDtBQUNEO0FBQ0Y7O0FBRUQsSUFBSU0sS0FBSjs7QUFDQSxJQUFJLE9BQU9DLFFBQVAsS0FB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Ozs7QUFHTyxJQUFNQyxzQkFBc0IsR0FBRztBQUNwQ0MsRUFBQUEsT0FEb0MsbUJBQzNCQyxNQUQyQixFQUNoQjtBQUNsQkEsSUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxLQUFoQixDQUFzQnZDLFNBQXRCO0FBQ0Q7QUFIbUMsQ0FBL0I7OztBQVlQLElBQUksT0FBT3dDLE1BQVAsS0FBa0IsV0FBbEIsSUFBaUNBLE1BQU0sQ0FBQ0MsUUFBNUMsRUFBc0Q7QUFDcERELEVBQUFBLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsR0FBaEIsQ0FBb0JQLHNCQUFwQjtBQUNEOztlQUVjQSxzQiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgWEVVdGlscyBmcm9tICd4ZS11dGlscy9tZXRob2RzL3hlLXV0aWxzJ1xyXG4vLyBpbXBvcnQgeyBWWEVUYWJsZSB9IGZyb20gJ3Z4ZS10YWJsZSdcclxuXHJcbmZ1bmN0aW9uIGdldEN1cnNvclBvc2l0aW9uICh0ZXh0YXJlYTogSFRNTFRleHRBcmVhRWxlbWVudCkge1xyXG4gIGxldCByYW5nZURhdGEgPSB7IHRleHQ6ICcnLCBzdGFydDogMCwgZW5kOiAwIH1cclxuICBpZiAodGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UpIHtcclxuICAgIHJhbmdlRGF0YS5zdGFydCA9IHRleHRhcmVhLnNlbGVjdGlvblN0YXJ0XHJcbiAgICByYW5nZURhdGEuZW5kID0gdGV4dGFyZWEuc2VsZWN0aW9uRW5kXHJcbiAgfVxyXG4gIHJldHVybiByYW5nZURhdGFcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Q3Vyc29yUG9zaXRpb24gKHRleHRhcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50LCByYW5nZURhdGE6IGFueSkge1xyXG4gIGlmICh0ZXh0YXJlYS5zZXRTZWxlY3Rpb25SYW5nZSkge1xyXG4gICAgdGV4dGFyZWEuZm9jdXMoKVxyXG4gICAgdGV4dGFyZWEuc2V0U2VsZWN0aW9uUmFuZ2UocmFuZ2VEYXRhLnN0YXJ0LCByYW5nZURhdGEuZW5kKVxyXG4gIH1cclxufVxyXG5cclxudmFyICR0ZXh0OiBIVE1MU3BhbkVsZW1lbnRcclxuaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAkdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxyXG4gICR0ZXh0LmNsYXNzTmFtZSA9ICd4LXRleHRhcmVhLS1yZXNpemUnXHJcbiAgJHRleHQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nXHJcbiAgJHRleHQuc3R5bGUuekluZGV4ID0gJy0xJ1xyXG4gICR0ZXh0LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJ1xyXG59XHJcblxyXG5mdW5jdGlvbiBhdXRvUmVzaXplVGV4dGFyZWEgKGV2bnQ6IGFueSwgcmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gIGxldCB7IHByb3BzID0ge30gfSA9IHJlbmRlck9wdHNcclxuICBsZXQgeyAkdGFibGUsIGNvbHVtbiB9ID0gcGFyYW1zXHJcbiAgbGV0IHsgcmVuZGVyV2lkdGg6IG1pbldpZHRoLCByZW5kZXJIZWlnaHQ6IG1pbkhlaWdodCB9ID0gY29sdW1uXHJcbiAgbGV0IGlucEVsZW0gPSBldm50LnRhcmdldFxyXG4gIC8vIGxldCBjZWxsID0gaW5wRWxlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUgPyBpbnBFbGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlIDogbnVsbFxyXG4gIGxldCBtYXhXaWR0aCA9IHByb3BzLm1heFdpZHRoIHx8IDYwMFxyXG4gIGxldCBtYXhIZWlnaHQgPSBwcm9wcy5tYXhIZWlnaHQgfHwgNDAwXHJcbiAgJHRleHQudGV4dENvbnRlbnQgPSBgJHtpbnBFbGVtLnZhbHVlfVxcbmBcclxuICAkdGV4dC5zdHlsZS5tYXhXaWR0aCA9IGAke21heFdpZHRofXB4YFxyXG4gIGlmICghJHRleHQucGFyZW50Tm9kZSkge1xyXG4gICAgJHRhYmxlLiRlbC5hcHBlbmRDaGlsZCgkdGV4dClcclxuICB9XHJcbiAgbGV0IGhlaWdodCA9IE1hdGgubWluKG1heEhlaWdodCwgJHRleHQub2Zmc2V0SGVpZ2h0ICsgNClcclxuICBpbnBFbGVtLnN0eWxlLndpZHRoID0gYCR7TWF0aC5taW4obWF4V2lkdGgsIE1hdGgubWF4KG1pbldpZHRoLCAkdGV4dC5vZmZzZXRXaWR0aCArIDIwKSl9cHhgXHJcbiAgaW5wRWxlbS5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHQgPCBtaW5IZWlnaHQgPyBtaW5IZWlnaHQgOiBoZWlnaHR9cHhgXHJcbiAgaW5wRWxlbS5zdHlsZS5vdmVyZmxvd1kgPSBoZWlnaHQgPiBtYXhXaWR0aCA/ICdhdXRvJyA6ICcnXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEV2ZW50cyAocmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gIGxldCB7IGV2ZW50cyB9ID0gcmVuZGVyT3B0c1xyXG4gIGxldCB7ICR0YWJsZSwgY29sdW1uIH0gPSBwYXJhbXNcclxuICBsZXQgeyBtb2RlbCB9ID0gY29sdW1uXHJcbiAgbGV0IG9uID0ge1xyXG4gICAgaW5wdXQgKGV2bnQ6IGFueSkge1xyXG4gICAgICBsZXQgY2VsbFZhbHVlID0gZXZudC50YXJnZXQudmFsdWVcclxuICAgICAgbW9kZWwudXBkYXRlID0gdHJ1ZVxyXG4gICAgICBtb2RlbC52YWx1ZSA9IGNlbGxWYWx1ZVxyXG4gICAgICAkdGFibGUudXBkYXRlU3RhdHVzKHBhcmFtcywgY2VsbFZhbHVlKVxyXG4gICAgfVxyXG4gIH1cclxuICBpZiAoZXZlbnRzKSB7XHJcbiAgICBYRVV0aWxzLmFzc2lnbihvbiwgWEVVdGlscy5vYmplY3RNYXAoZXZlbnRzLCAoY2I6IEZ1bmN0aW9uKSA9PiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNiLmFwcGx5KG51bGwsIFtwYXJhbXNdLmNvbmNhdC5hcHBseShwYXJhbXMsIGFyZ3VtZW50cykpXHJcbiAgICB9KSlcclxuICB9XHJcbiAgcmV0dXJuIG9uXHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmuLLmn5Plh73mlbBcclxuICovXHJcbmNvbnN0IHJlbmRlck1hcCA9IHtcclxuICBYSW5wdXQ6IHtcclxuICAgIGF1dG9mb2N1czogJy54LWlucHV0JyxcclxuICAgIHJlbmRlckVkaXQgKGg6IEZ1bmN0aW9uLCByZW5kZXJPcHRzOiBhbnksIHBhcmFtczogYW55KSB7XHJcbiAgICAgIGxldCB7IHByb3BzID0ge30sIGF0dHJzLCBldmVudHMgPSB7fSB9ID0gcmVuZGVyT3B0c1xyXG4gICAgICBsZXQgeyBjb2x1bW4gfSA9IHBhcmFtc1xyXG4gICAgICBsZXQgeyBtb2RlbCB9ID0gY29sdW1uXHJcbiAgICAgIGxldCB7IHByZWZpeEljb24sIHN1ZmZpeEljb24gfSA9IHByb3BzXHJcbiAgICAgIGxldCB7IHByZWZpeENsaWNrLCBzdWZmaXhDbGljayB9ID0gZXZlbnRzXHJcbiAgICAgIHJldHVybiBbXHJcbiAgICAgICAgaCgnZGl2Jywge1xyXG4gICAgICAgICAgY2xhc3M6IFsneC1pbnB1dC0td3JhcHBlcicsIHtcclxuICAgICAgICAgICAgJ2lzLS1wcmVmaXgnOiBwcm9wcy5wcmVmaXhJY29uLFxyXG4gICAgICAgICAgICAnaXMtLXN1ZmZpeCc6IHByb3BzLnN1ZmZpeEljb25cclxuICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgc3R5bGU6IHtcclxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtjb2x1bW4ucmVuZGVySGVpZ2h0IC0gMX1weGBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBbXHJcbiAgICAgICAgICBwcmVmaXhJY29uID8gaCgnaScsIHtcclxuICAgICAgICAgICAgY2xhc3M6IFsneC1pbnB1dC0tcHJlZml4JywgcHJlZml4SWNvbiwge1xyXG4gICAgICAgICAgICAgICdpcy0tdHJpZ2dlcic6IHByZWZpeENsaWNrXHJcbiAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBvbjogcHJlZml4Q2xpY2sgPyB7XHJcbiAgICAgICAgICAgICAgY2xpY2s6IChldm50OiBhbnkpID0+IHByZWZpeENsaWNrKHBhcmFtcywgZXZudClcclxuICAgICAgICAgICAgfSA6IG51bGxcclxuICAgICAgICAgIH0pIDogbnVsbCxcclxuICAgICAgICAgIGgoJ2lucHV0Jywge1xyXG4gICAgICAgICAgICBjbGFzczogJ3gtaW5wdXQnLFxyXG4gICAgICAgICAgICBhdHRycyxcclxuICAgICAgICAgICAgZG9tUHJvcHM6IHtcclxuICAgICAgICAgICAgICB2YWx1ZTogbW9kZWwudmFsdWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb246IGdldEV2ZW50cyhyZW5kZXJPcHRzLCBwYXJhbXMpXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIHN1ZmZpeEljb24gPyBoKCdpJywge1xyXG4gICAgICAgICAgICBjbGFzczogWyd4LWlucHV0LS1zdWZmaXgnLCBzdWZmaXhJY29uLCB7XHJcbiAgICAgICAgICAgICAgJ2lzLS10cmlnZ2VyJzogc3VmZml4Q2xpY2tcclxuICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIG9uOiBzdWZmaXhDbGljayA/IHtcclxuICAgICAgICAgICAgICBjbGljazogKGV2bnQ6IGFueSkgPT4gc3VmZml4Q2xpY2socGFyYW1zLCBldm50KVxyXG4gICAgICAgICAgICB9IDogbnVsbFxyXG4gICAgICAgICAgfSkgOiBudWxsXHJcbiAgICAgICAgXSlcclxuICAgICAgXVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgWFRleHRhcmVhOiB7XHJcbiAgICBhdXRvZm9jdXM6ICcueC10ZXh0YXJlYScsXHJcbiAgICByZW5kZXJFZGl0IChoOiBGdW5jdGlvbiwgcmVuZGVyT3B0czogYW55LCBwYXJhbXM6IGFueSkge1xyXG4gICAgICBsZXQgeyBhdHRycywgZXZlbnRzIH0gPSByZW5kZXJPcHRzXHJcbiAgICAgIGxldCB7ICR0YWJsZSwgY29sdW1uIH0gPSBwYXJhbXNcclxuICAgICAgbGV0IHsgbW9kZWwgfSA9IGNvbHVtblxyXG4gICAgICBsZXQgYXV0b1Jlc2l6ZUV2ZW50ID0gKGV2bnQ6IGFueSkgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gYXV0b1Jlc2l6ZVRleHRhcmVhKGV2bnQsIHJlbmRlck9wdHMsIHBhcmFtcyksIDApXHJcbiAgICAgICAgaWYgKGV2ZW50cyAmJiBldmVudHNbZXZudC50eXBlXSkge1xyXG4gICAgICAgICAgZXZlbnRzW2V2bnQudHlwZV0ocGFyYW1zLCBldm50KVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gW1xyXG4gICAgICAgIGgoJ2RpdicsIHtcclxuICAgICAgICAgIGNsYXNzOiAneC10ZXh0YXJlYS0td3JhcHBlcicsXHJcbiAgICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICBoZWlnaHQ6IGAke2NvbHVtbi5yZW5kZXJIZWlnaHQgLSAxfXB4YFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIFtcclxuICAgICAgICAgIGgoJ3RleHRhcmVhJywge1xyXG4gICAgICAgICAgICBjbGFzczogJ3gtdGV4dGFyZWEnLFxyXG4gICAgICAgICAgICBhdHRycyxcclxuICAgICAgICAgICAgZG9tUHJvcHM6IHtcclxuICAgICAgICAgICAgICB2YWx1ZTogbW9kZWwudmFsdWVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb246IFhFVXRpbHMuYXNzaWduKGdldEV2ZW50cyhyZW5kZXJPcHRzLCBwYXJhbXMpLCB7XHJcbiAgICAgICAgICAgICAgY3V0OiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAgcGFzdGU6IGF1dG9SZXNpemVFdmVudCxcclxuICAgICAgICAgICAgICBkcm9wOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAgZm9jdXM6IGF1dG9SZXNpemVFdmVudCxcclxuICAgICAgICAgICAgICBrZXlkb3duIChldm50OiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldm50LmtleUNvZGUgPT09IDEzICYmICghJHRhYmxlLmtleWJvYXJkQ29uZmlnIHx8IGV2bnQuYWx0S2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICBldm50LnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICAgICAgICAgICAgZXZudC5zdG9wUHJvcGFnYXRpb24oKVxyXG4gICAgICAgICAgICAgICAgICBsZXQgaW5wRWxlbSA9IGV2bnQudGFyZ2V0XHJcbiAgICAgICAgICAgICAgICAgIGxldCByYW5nZURhdGEgPSBnZXRDdXJzb3JQb3NpdGlvbihpbnBFbGVtKVxyXG4gICAgICAgICAgICAgICAgICBsZXQgcG9zID0gcmFuZ2VEYXRhLmVuZFxyXG4gICAgICAgICAgICAgICAgICBsZXQgY2VsbFZhbHVlID0gaW5wRWxlbS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgICBjZWxsVmFsdWUgPSBgJHtjZWxsVmFsdWUuc2xpY2UoMCwgcG9zKX1cXG4ke2NlbGxWYWx1ZS5zbGljZShwb3MsIGNlbGxWYWx1ZS5sZW5ndGgpfWBcclxuICAgICAgICAgICAgICAgICAgaW5wRWxlbS52YWx1ZSA9IGNlbGxWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICBtb2RlbC51cGRhdGUgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICAgIG1vZGVsLnZhbHVlID0gY2VsbFZhbHVlXHJcbiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlRGF0YS5zdGFydCA9IHJhbmdlRGF0YS5lbmQgPSArK3Bvc1xyXG4gICAgICAgICAgICAgICAgICAgIHNldEN1cnNvclBvc2l0aW9uKGlucEVsZW0sIHJhbmdlRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICBhdXRvUmVzaXplRXZlbnQoZXZudClcclxuICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIGF1dG9SZXNpemVFdmVudChldm50KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgY29tcG9zaXRpb25zdGFydDogYXV0b1Jlc2l6ZUV2ZW50LFxyXG4gICAgICAgICAgICAgIGNvbXBvc2l0aW9udXBkYXRlOiBhdXRvUmVzaXplRXZlbnQsXHJcbiAgICAgICAgICAgICAgY29tcG9zaXRpb25lbmQ6IGF1dG9SZXNpemVFdmVudFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICBdKVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAgcmVuZGVyQ2VsbCAoaDogRnVuY3Rpb24sIHJlbmRlck9wdHM6IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICAgICAgbGV0IHsgcm93LCBjb2x1bW4gfSA9IHBhcmFtc1xyXG4gICAgICByZXR1cm4gW1xyXG4gICAgICAgIGgoJ3NwYW4nLCB7XHJcbiAgICAgICAgICBjbGFzczogJ3gtdGV4dGFyZWEtLWNvbnRlbnQnXHJcbiAgICAgICAgfSwgWEVVdGlscy5nZXQocm93LCBjb2x1bW4ucHJvcGVydHkpKVxyXG4gICAgICBdXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmj5DkvpvkuIDkupvluLjnlKjnmoTmuLLmn5PlmahcclxuICovXHJcbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpblJlbmRlcmVyID0ge1xyXG4gIGluc3RhbGwgKHh0YWJsZTogYW55KSB7XHJcbiAgICB4dGFibGUucmVuZGVyZXIubWl4aW4ocmVuZGVyTWFwKVxyXG4gIH1cclxufVxyXG5cclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gIGludGVyZmFjZSBXaW5kb3cge1xyXG4gICAgVlhFVGFibGU6IGFueVxyXG4gIH1cclxufVxyXG5cclxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xyXG4gIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5SZW5kZXJlcilcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVlhFVGFibGVQbHVnaW5SZW5kZXJlclxyXG4iXX0=
